<!DOCTYPE html>
<html>
  <head>
    <title>数独小游戏</title>
    <style>
      .sudoku {
        display: inline-block;
        margin: 10px;
      }

      table {
        text-align: center;
        border-collapse: collapse;
        font-size: 24px;
      }

      td {
        width: 40px;
        height: 40px;
        border: 1px solid #ccc;
      }

      input {
        width: 100%;
        height: 100%;
        font-size: 24px;
        border: none;
        text-align: center;
        font-weight: bold;
      }

      .readonly {
        background-color: #eee;
      }

      .error {
        color: red;
      }

      button {
        display: block;
        font-size: 20px;
        margin-top: 10px;
        padding: 10px;
        cursor: pointer;
      }
    </style>
  </head>

  <body>
    <h1>数独小游戏</h1>
    <div class="sudoku">
      <h2>解答面板</h2>
      <table id="board"></table>
    </div>

    <script>
      var queryString = window.location.search;
      var params = new URLSearchParams(queryString);
      var variableValue = params.get("variableName");

      var variableValue = variableValue
        .split(",")
        .filter(function (item) {
          return item !== "";
        })
        .map(function (item) {
          return parseInt(item);
        });

      // 将二维数组转换为 9 * 9 的二维数组
      var solution = [];
      for (var i = 0; i < 9; i++) {
        solution[i] = variableValue.slice(i * 9, (i + 1) * 9);
      }

      var board = [];

      // 生成数独面板
      function generateBoard() {
        // 初始化数独数组
        board = new Array(9).fill(null).map(() => new Array(9).fill(null));

        // 随机填入数字
        answer(board);

        // 渲染数独面板
        renderBoard();
      }

      // 渲染数独面板
      function renderBoard() {
        var table = document.getElementById("board");
        table.innerHTML = "";

        for (var i = 0; i < 9; i++) {
          var row = document.createElement("tr");

          for (var j = 0; j < 9; j++) {
            var cell = document.createElement("td");
            var input = document.createElement("input");

            if (board[i][j] !== null) {
              input.value = board[i][j];
              input.classList.add("readonly");
              input.readOnly = true;
            } else {
              input.addEventListener("input", validateInput.bind(null, i, j));
            }

            cell.appendChild(input);
            row.appendChild(cell);
          }

          table.appendChild(row);
        }
      }

      window.onload = function () {
        generateBoard();
      };

      // 用回溯法解答数独
      function answer(board) {
        for (var i = 0; i < 9; i++)
          for (var j = 0; j < 9; j++) board[i][j] = solution[i][j];
      }

      // 验证用户输入
      function validateInput(row, col) {
        var input = event.target;
        var num = parseInt(input.value);

        if (
          isNaN(num) ||
          num < 1 ||
          num > 9 ||
          !isValidMove(board, row, col, num)
        ) {
          input.classList.add("error");
        } else {
          input.classList.remove("error");
          board[row][col] = num;
        }
      }
    </script>
  </body>
</html>
